# IRR计算器 - 最终版使用说明

## 文件说明

### 主要文件
- **`irr_calculator_final.py`** - Python版本的IRR计算器
- **`irr_calculator_final.html`** - HTML版本的IRR计算器（可在浏览器中运行）
- **`数据底稿.xlsx`** - 原始数据文件
- **`IRR计算结果_最终版.xlsx`** - 计算结果输出文件

## 功能特点

### ✅ 已实现的功能
1. **显示所有数据行** - 不隐藏任何年份的数据，IRR为负数时显示为空
2. **增加累计提取金额列** - 在提取金额后显示"已提取金额累计"列
3. **IRR保留2位小数** - 从原来的4位小数改为2位小数显示
4. **完整的现金流计算** - 基于保费信息和提取数据构建准确的现金流
5. **关键年份汇总** - 显示重要年份的IRR结果（仅正数）
6. **Excel报告导出** - 生成详细的计算结果报告

### 📊 显示格式
```
年份 | 提取金额（元） | 已提取金额累计（元） | 提取后总价值 | 现金流期数 | IRR%
------------------------------------------------------------------------
 2   |      0        |        0           |     640     |     6     |   -
 7   |   2,000       |     4,000          |   31,842    |     8     | 1.09%
10   |   2,000       |    10,000          |   33,857    |    11     | 3.56%
15   |   3,300       |    26,500          |   31,938    |    16     | 5.28%
...
```

## 使用方法

### Python版本
```bash
python irr_calculator_final.py
```

### HTML版本
1. 双击打开 `irr_calculator_final.html`
2. 在浏览器中设置保费参数
3. 上传数据底稿Excel文件
4. 查看计算结果和图表

## 计算逻辑

### 保费现金流
- 第1年：首年保费（终） = 年缴金额 - 首年优惠 + 监管征费
- 第2-5年：每年年缴金额

### IRR计算现金流构成
- 第1-5年：保费支出（负现金流）
- 第6年至第N年：如果有提取则为提取金额，否则为0
- 第N+1年：提取后总价值（正现金流）

### 结果显示规则
- ✅ 显示所有数据行，不隐藏任何年份
- ❌ IRR为负数或计算失败时显示为空
- 📊 统计显示负数IRR数量
- 🔢 IRR保留2位小数（如：3.56%）

### 累计提取金额计算
- 累计金额 = 从第1年到当前年份的所有提取金额之和
- 例如：第15年的累计提取 = 第6-15年所有提取金额的总和

## 输出结果

### 控制台输出
- 保费信息汇总
- 提取年份列表
- 完整结果表格（包含所有行）
- 关键年份IRR汇总（仅正数）
- 统计信息

### Excel报告
- 计算说明和参数
- 完整结果表格（包含累计提取金额列）
- 负数IRR统计

## 表格列说明

1. **年份** - 保单年度
2. **提取金额（元）** - 该年度的提取金额
3. **已提取金额累计（元）** - 从开始到该年度的累计提取总额
4. **提取后总价值（元）** - 该年度提取后的剩余价值
5. **现金流期数** - 现金流的总期数
6. **IRR (%)** - 内部收益率，负数时显示为空

## 注意事项

1. **数据完整性**：所有年份的数据都会显示，不会隐藏
2. **负数处理**：IRR为负数时显示为空，但保留其他数据
3. **累计计算**：累计提取金额是动态计算的累计值
4. **精度显示**：IRR统一保留2位小数，便于阅读

## 技术特点

- 使用二分法进行IRR数值求解
- 自动识别数据开始行
- 智能处理提取时点
- 动态计算累计提取金额
- 支持拖拽上传（HTML版本）
- 响应式设计（HTML版本）

## 示例结果

根据数据底稿，典型的计算结果如下：
- **前几年**：IRR为负数，显示为空
- **第7年开始**：IRR转为正数，从1.09%开始
- **第10年**：IRR达到3.56%
- **第15年**：IRR达到5.28%
- **第20年**：IRR达到6.11%
- **第25年**：IRR达到6.24%

总计显示29行数据，其中5个负数IRR显示为空。

---

**版本**：最终版  
**更新时间**：2024年  
**功能**：显示所有行，负数IRR为空，IRR保留2位小数，增加累计提取金额列 